<include file="public/header" title="填写资料"  body="page-cart page-report-cart page-purch page-fill-info"/>
<link rel="stylesheet" type="text/css" href="__STATIC__/tonghaoran/css/common.css">
<link rel="stylesheet" type="text/css" href="__STATIC__/tonghaoran/css/mr_style.css">
<style type="text/css">
.btn-submit .sub{
    display: block;
    margin: auto;
    width: 80%;
    height: 1.75rem;
    line-height: 1.7rem;
    background-color: #2cd0b5;
    border-radius: 0.85rem;
    text-align: center;
    font-size: 0.75rem;
    color: #fefefe;
}
</style>
<header id="header" class="">
    <div class="icon-back" onclick="window.location.href='{:U('cosmetology/Mine/index')}'"></div>
    <h5>填写资料</h5>
</header>

<div class="container" id="all">
    <div class="main">

        <div class="inp-box">
            <label for = "invicode">邀请码</label>
                <input type="text" name="" id="invicode" value="" placeholder="请输入您的邀请码">

        </div>
        <div class="inp-box">
            <label for = "username">姓名</label>
                <input type="text" name="" id="username" value="" placeholder="请输入您的姓名">

        </div>
        <div class="inp-box">
            <label for = "userphone">手机号</label>
                <input type="text" name="" id="userphone" value="" placeholder="请输入您的手机号">

        </div>
        <div class="inp-box">
            <label for = "useridcode">身份证号</label>
                <input type="text" name="" id="useridcode" value="" placeholder="请输入您的身份证号">

        </div>
        <div class="inp-box">
            <label for = "wechatnumber">微信号</label>
                <input type="text" name="" id="wechatnumber" value="" placeholder="请输入您的微信号（可选）">

        </div>
        <div class="inp-box">
            <label for = "usermailbox">邮箱</label>
                <input type="text" name="" id="usermailbox" value="" placeholder="请输入您的邮箱（可选）">

        </div>

        <div class="inp-level">
            <div class="inp-level1">
                <span>代理级别</span>
                <div class="sele-level">
                    <span>请选择代理级别</span>
                    <div class="icon-down"></div>
                </div>
            </div>
            <ul>
                <volist name="all_level" id="level">
                    <li id="level{$level[level_id]}">{$level[level_name]}</li>
                </volist>
            </ul>
        </div>

        <volist name="all_level" id="level">
            <div class="dealer-box" style="display: none;" id="level_conten{$level[level_id]}">
                <div class="dealer-con">
                    <div class="dealer">
                        <div  class="dealer-img">
                            <img src="__STATIC__/tonghaoran/images/proxy1.png">
                            <div class="dealer-img-txt">
                                <p class="p1">{$level[level_name]}</p>
                                <p class="p2">JINGXIAOSHANG</p>
                            </div>
                        </div>
                        <div class="dealer-txt">成为{$level[level_name]}</div>
                        <div class="dealer-num">¥ {$level[amount]}</div>
                    </div>
                    <div class="dealer-stats">{$level[describe]}</div>
                </div>

                <div class="taocan">产品列表</div>
                <div>
                    <volist name="upgrade_suite[upgrade_suite][$level[level_id]][goods]" id='list' key='key'>
                        <div class="list">
                            <div class="box flex-row" data-num="1" data-price="895">
                                <div class="img"><img src="{$upgrade_suite[goods_info][$key-1][original_img]}" alt=""></div>
                                <div class="right flex-column">
                                    <div class="name">{$upgrade_suite[goods_info][$key-1][goods_name]}{$key-1}</div>
                                    <!-- <div class="spec">规格:100ML规格:100ML规格:100ML规格:100ML规格:100ML规格:100ML规格:100ML</div> -->
                                    <div class="sbot flex-row">
                                        <div class="price">¥{$upgrade_suite[goods_info][$key-1][shop_price]}</div>
                                        <div class="flex-row" style="color: #1c1c1c;">X{$list}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </volist>
                </div>
            </div>
        </volist>


        <div class="inp-box shop_show">
            <label for = "storename">店铺名称</label>
                <input type="text" name="" id="storename" value="" placeholder="请输入您的店铺名称">

        </div>
        <div class="inp-box shop_show">
            <label for = "storeintroduction">店铺介绍</label>
                <input type="text" name="" id="storeintroduction" value="" placeholder="请输入店铺介绍">

        </div>
        <div class="inp-logo flex-row shop_show">
            <div class="left">
                <span>店铺LOGO</span>
            </div>
            <div class="logo-camera">
                <img src="__STATIC__/tonghaoran/images/icon_camera.png">
            </div>
        </div>

        <div class="identity">
            <div class="tit">请选择身份上传照片</div>
            <div class="identity1">
                <label class="">
                    <input name="identity" type="radio" value="0" id="weixin_seller">
                </label>
                <div class="identity1-txt">微信卖家（连续三周每周至少三条微信朋友圈
                    分享商品的截图以及微信个人中心截图）</div>
            </div>
            <div class="identity1">
                <label class="">
                    <input name="identity" type="radio" value="1" id="pintai_seller">
                </label>
                <div class="identity1-txt">线上平台卖家（店铺后台商家账户截图）</div>
            </div>
            <div class="identity1">
                <label class="">
                    <input name="identity" type="radio" value="2"  id="shiti_seller">
                </label>
                <div class="identity1-txt">线下实体卖家（公司注册资质、法人身份证正
                    反面、实体照片</div>
            </div>

            <div class="identity1 identity1-photo">
                <!--<div class="identity1-addimg"></div>-->
                <div class="identity1-add">
                    <img src="__STATIC__/images/icon_addimg.png">
                    <input class="add-photo" type="file" accept="image/*" capture="camera">
                </div>

            </div>
        </div>

        <div class="btn btn-submit">
            <button type="submit" class="sub">提交</button>
        </div>
    </div>

</div>

<div class="y_avatar">
    <ul>
        <li class="photo">
            <input id="takepicture" type="file" accept="image/*" capture="camera" >拍照上传
        </li>
        <li class="album">
            <input type="file" class="add-img" accept="image/*" value="" />从相册选择
        </li>
        <li class="cancel">取消</li>
    </ul>
</div>

<div class="mask"></div>

</body>

<script type="text/javascript" src="__STATIC__/tonghaoran/js/dialog-plus-min.js"></script>
<script type="text/javascript" src="__STATIC__/tonghaoran/js/vue.js"></script>
<script type="text/javascript" src="__STATIC__/tonghaoran/js/jquery.cookie.js"></script>
<script>

    $(function(){
        var grade = '';


        vm = new Vue({
            el: '#all',
            data: {
                isShowPswFlag: false, //是否显示密码
                isShowAgainPswFlag: false, //
                pswValue: '',
                againPswValue: '',
                isHyCodeFlag: true, //是否有好友邀请码
            },
            methods: {
                //显示密码
                showPswFun: function(){
                    this.isShowPswFlag = true;
                },
                hidePswFun: function(){
                    this.isShowPswFlag = false;
                },
                showAgainPswFun: function(){
                    this.isShowAgainPswFlag = true;
                },
                hideAgainPswFun: function(){
                    this.isShowAgainPswFlag = false;
                },
                /*改变是否有好友邀请码*/
                chooseFrindCode: function(e){
                    this.isHyCodeFlag = e.target.checked;
                }
            }
        })

        $('.btn-submit').on('click', function(){
            var flag = flagFun();
            if(flag){
                var storename = $('#storename').val();     //店铺名
                var storeintroduction = $('#storeintroduction').val();  //店铺介绍

                if(grade != 2){
                    if(storename === ''){
                        dialogFun_two('请输入您的店铺名');
                        return false;
                    }
                    if(storeintroduction === ''){
                        dialogFun_two('请输入您的店铺介绍');
                        return false;
                    }
                    //店铺logo
                    var shop_logo = $('.logo-camera img').attr('src');
                    if(shop_logo == '/template/web/rainbow/static/tonghaoran/images/icon_camera.png'){
                        dialogFun_two('请上传店铺logo');
                        return false;
                    }
                }

                //选择身份等级
                if(grade == ''){
                    dialogFun_two('请选择代理级别');
                    return false;
                }

                //选择卖家类型身份按钮
                var identity = $('.identity .identity1 label input[name="identity"]:checked').attr('id');
                if(identity == undefined || identity == '' || identity == null){
                    dialogFun_two('请选择你要上传的图片的类型');
                    return false;
                }
                //身份图片
                var arr = [];
                $.each($('.identity1-photo .has-img'), function(is, el){
                    arr.push($(el).children('img').attr('src'))
                })

                if(arr == ''){
                    dialogFun_two('请上传身份图片');
                    return false;
                }

                var invicode = $('#invicode').val();  //邀请码
                var username = $('#username').val();  //姓名
                var userphone = $('#userphone').val();   //电话
                var useridcode = $('#useridcode').val();  //身份证
                var wechatnumber = $('#wechatnumber').val();  //微信号
                var usermailbox = $('#usermailbox').val();   //邮箱
                if(usermailbox != '' && !usermailbox.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)){
                    dialogFun_two('邮箱格式有误');
                    return false;
                }

                $.post("{:U('cosmetology/Mine/data_submitting')}", {invicode:invicode,username:username,userphone:userphone,useridcode:useridcode,wechatnumber:wechatnumber,usermailbox:usermailbox,storename:storename,storeintroduction:storeintroduction,shop_logo:shop_logo,grade:grade,identity:identity,arr:arr},function(datas){

                    var values = JSON.parse(datas);
                    // console.log(values);//125252526525645254
                    if(values['status'] == 1){
                        dialogFun(values['msg'],"{:U('cosmetology/Mine/index')}");
                    }else{
                        dialogFun(values['msg']);
                    }
                });
            }
        })



        $('.main').on('click', '.inp-level .sele-level', function(){
            $(".inp-level ul").show()
            $('.dealer-box').hide()
        })
        
        $('.main').on('click', '.inp-level li', function(){
            $(".inp-level .sele-level span").text($(this).text())
            $(this).parent("ul").hide()

            var level_id = $(this).attr('id').substring(5);
            var level_conten = "#level_conten"+level_id;
            grade = level_id;
            $('.dealer-box').hide()
            $(level_conten).show()
            // console.log("#level_conten"+level_id)
            if(grade == 2){
                $('.shop_show').hide();
            }else{
                $('.shop_show').show();
            }

        })

        $('.main').on('click', '.identity1 label', function(){
            if(!$(this).hasClass("on")){
                $(".identity1 label").removeClass("on")
                $(this).addClass("on")
            }/*else {
                $(this).removeClass("on")
            }*/
            // console.log(222)
            // console.log($(this).children("input").is(":checked"))
            var ind = $(this).children("input").val();
            if (ind == 0){
                $(".identity1-add").attr("data-index","weixin")
            }
            if (ind == 1){
                $(".identity1-add").attr("data-index","xianshang")
            }
            if (ind == 2){
                $(".identity1-add").attr("data-index","xianxia")
            }
        })

        //减数量
        $('.main').on('click', '.box .sub', function(e){
            var $box = $(this).closest('.box');
            var num = parseInt($box.data('num'))
            if(num > 1){
                num -= 1;
                $box.data('num', num)
                $box.find('.num').html(num)
                countPrice()
            }
        })
        //加
        $('.main').on('click', '.box .add', function(e){
            var $box = $(this).closest('.box');
            var num = parseInt($box.data('num'))
            num += 1;
            $box.data('num', num)
            $box.find('.num').html(num)
            countPrice()
        })

        //计算价格 显示
        countPrice()
        function countPrice(){
            var box = $('.main .box');
            var price = 0; //总价格
            var len = 0; //选中的个数
            $.each(box, function(is, el){
                // if($(el).find('.choose')[0].checked){
                var num = parseInt($(el).data('num'))
                var pr = parseFloat($(el).data('price'))
                len++;
                price += num * pr;
                // }
                $('#allPrice').html('￥' + price)
            })
            price = parseFloat(price.toFixed(2))

            $('#allPrice').html('￥' + price)
        }




        //修改logo
        $(".logo-camera").on("mousedown",function(){
            $(".y_avatar").show();
            $(".mask").show();
        });


        // 拍照
        $(".page-fill-info .photo").on("click",function () {
            $(".y_avatar").hide();
            $(".mask").hide();
        })
        // 相册
        $(".page-fill-info .album").on("click",function () {
            $(".y_avatar").hide();
            $(".mask").hide();
        })
        // 取消
        $(".page-fill-info .cancel").on("mousedown",function () {
            $(".y_avatar").hide();
            $(".mask").hide();
        })





        $('.page-fill-info').on('change', '.add-photo', function(event) {
            console.log($(this).parent()[0].hasAttribute("data-index"))
            if(!$(this).parent()[0].hasAttribute("data-index")){
                addPhoto()
            }
                event.stopPropagation();
                var oFile = this.files[0]
                var _this = this
                var fr = new FileReader();
                var rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;
                if (!rFilter.test(oFile.type)) {
                    errorFun()
                    return;
                };
                // console.log(event.target.value)//target.ownerDocument.value
                fr.readAsDataURL(oFile);

                fr.onload = function(FREvent) {
                    console.log(FREvent)
                    dealImage(FREvent.target.result, {
                        width : 500
                    }, function(base){
                        // console.log(oFile)
                        // console.log(base)
                        // $.post("{:U('cosmetology/Mine/uploadPictures')}", {base:base},function(datas){});
                        $(_this).siblings("img").attr('src',base);
                        // $(".page-fill-info .identity1-addimg img").attr('src',base);
                    })
                }
            })


        $('.page-fill-info').on('change', '.add-img', function(event) {
            event.stopPropagation();
            var oFile = this.files[0]
            var _this = this
            var fr = new FileReader();
            var rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;
            if (!rFilter.test(oFile.type)) {
                errorFun()
                return;
            };
            // console.log(event.target.value)//target.ownerDocument.value
            fr.readAsDataURL(oFile);

            fr.onload = function(FREvent) {
                // console.log(FREvent)
                dealImage(FREvent.target.result, {
                    width : 500
                }, function(base){
                    // $.post("{:U('cosmetology/Mine/uploadPictures')}", {base:base},function(datas){});
                    $(".page-fill-info .logo-camera img").attr('src',base);
                })
            }
        })

        function dealImage(path, obj, callback) {
            var img = new Image();
            img.src = path;
            img.onload = function() {
                var that = this;
                // 默认按比例压缩
                var w = that.width,
                    h = that.height,
                    scale = w / h;
                w = obj.width || w;
                h = obj.height || (w / scale);
                var quality = 0.7; // 默认图片质量为0.7
                //生成canvas
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                // 创建属性节点
                var anw = document.createAttribute("width");
                anw.nodeValue = w;
                var anh = document.createAttribute("height");
                anh.nodeValue = h;
                canvas.setAttributeNode(anw);
                canvas.setAttributeNode(anh);
                ctx.drawImage(that, 0, 0, w, h);
                // 图像质量
                if (obj.quality && obj.quality <= 1 && obj.quality > 0) {
                    quality = obj.quality;
                }
                // quality值越小，所绘制出的图像越模糊
                var type = 'image/jpeg'
                var str = path.substring(0, path.search(/\;/g))
                if(str.search(/(png)/g) >= 0){
                    type = 'image/png'
                }
                var base64 = canvas.toDataURL(type, quality);
                // 回调函数返回base64的值
                callback(base64);
                // $.post("{:U('cosmetology/Mine/uploadPictures')}", {base64:base64},function(datas){});
            }
        }

        function addPhoto() {
            var addDiv = '<div class="identity1-add"><img src="__STATIC__/images/icon_addimg.png"/><input class="add-photo" type="file" accept="image/*" capture="camera"> </div>';
            $(".identity1-photo").append(addDiv);
        }

        $('.page-fill-info').on('change', '.add-photo', function(event) {
            var identity = $('.identity .identity1 label input[name="identity"]:checked').attr('id');
            if(identity == undefined || identity == '' || identity == null){
                dialogFun_two('请选择你要上传的图片的类型');
                return false;
            }
            if(!$(this).parent().hasClass('has-img')){
                addPhoto()
            }
            event.stopPropagation();
            var oFile = this.files[0]
            var _this = this
            var fr = new FileReader();
            var rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;
            if (!rFilter.test(oFile.type)) {
                errorFun()
                return;
            };
            // console.log(event.target.value)//target.ownerDocument.value
            fr.readAsDataURL(oFile);

            fr.onload = function(FREvent) {
                // console.log(FREvent)
                dealImage(FREvent.target.result, {
                    width : 500
                }, function(base){
                    // $.post("{:U('cosmetology/Mine/uploadPictures')}", {base:base},function(datas){});
                    $(_this).siblings("img").attr('src',base);
                    $(_this).parent().addClass('has-img')
                    // $(".page-fill-info .identity1-addimg img").attr('src',base);
                    
                })
            }
        })



    })



    //判断是否都有输入
    function flagFun(){
        var invicode = $('#invicode').val();  //邀请码
        var username = $('#username').val();  //姓名
        var userphone = $('#userphone').val();   //电话
        var useridcode = $('#useridcode').val();  //身份证
        var wechatnumber = $('#wechatnumber').val();  //微信号
        var usermailbox = $('#usermailbox').val();   //邮箱
        var storename = $('#storename').val();     //店铺名
        var storeintroduction = $('#storeintroduction').val();  //店铺介绍

        /*if(invicode === ''){
            dialogFun_two('请输入您的邀请码');
            return false;
        }*/
        if(username === ''){
            dialogFun_two('请输入您的姓名');
            return false;
        }
        if(userphone === ''){
            dialogFun_two('请输入您的电话');
            return false;
        }
        
        var reg = /0?(13|14|15|17|18|19)[0-9]{9}/g;
        if(!reg.test(userphone) || userphone.length != 11){
            dialogFun_two('手机号码格式有误');
            return false;
        }

        if(useridcode === ''){
            dialogFun_two('请输入您的身份证');
            return false;
        }else{
            // 验证身份证
            if(isCardNo(useridcode) == false) {
                dialogFun_two('身份证号不正确');
                return false;
            }  
        }

        /*if(wechatnumber == ''){
            dialogFun_two('请输入您的微信号');
            return false;
        }
        if(usermailbox === ''){
            dialogFun_two('请输入您的邮箱');
            return false;
        }*/

        /*if(storename === ''){
            dialogFun_two('请输入您的店铺名');
            return false;
        }
        if(storeintroduction === ''){
            dialogFun_two('请输入您的店铺介绍');
            return false;
        }*/

        
        return true;
    }

    // 验证身份证 
function isCardNo(card) {  
   var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;  
   return pattern.test(card); 
}

function dialogFun(str,url=''){
    dialog({
        width: 280,
        title: '提示',
        content: str,
        cancel: false,
        okValue: '确定',
        ok: function(){
            if(url!==''){
                window.location.href=url;
            }
        }
    }).showModal();
}

function dialogFun_two(str){
    webToast(str,"middle",1000);
}


</script>
</html>